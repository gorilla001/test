function getCookie(e){return document.cookie.length>0&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}function setCookie(e,t,o){var n=new Date;n.setDate(n.getDate()+o),document.cookie=e+"="+escape(t)+(null==o?"":"; expires="+n.toGMTString())}function checkCookie(){username=getCookie("username"),null!=username&&""!=username?alert("Welcome again "+username+"!"):(username=prompt("Please enter your name:",""),null!=username&&""!=username&&setCookie("username",username,365))}$(function(){function e(){var e=t.modal({title:"手机号码验证",text:"为保证抢红包成功，请验证您的手机号码",afterText:'<div id="reg"><input type="tel" name="reg_smscode" id="reg_smscode" maxlength="6" placeholder="请输入短信验证码"/><button id="send_smscode">获取验证码</button><div id="reg_errmsg"></div></div>',buttons:[{text:"提交并领取红包",bold:!0,close:!1,onClick:function(){s()}}]});$("#send_smscode").on("click",function(){u||$.post("/api/auth/send_smscode",{mobile:c,_xsrf:n},function(e){return e&&e.errcode?void $("#reg_errmsg").text(e.errmsg):void m()})});var s=function(){var s=$("#reg_smscode").val();if(!s)return void $("#reg_errmsg").text("请输入短信验证码");var a={mobile:c,code:code,smscode:s,_xsrf:n};$.post(o,a,function(o){if(!o||o.errcode)return void $("#reg_errmsg").text(o.errmsg);t.closeModal(e);var n=parseInt(o.coupon.discount/100);$("#number").text(n),$(".hint .mobile").text(c),r.hide(),i.show(),store.set("mobile",c)})}}var t=new Framework7({modalTitle:"有菜提示",modalButtonOk:"确定",modalButtonCancel:"取消"}),o="/api/coupon",n=getCookie("_xsrf"),r=$(".action_1"),i=$(".action_2"),s=$("#mobile"),c=store.get("mobile");c&&!isNaN(c)&&s.val(c)&&$(".hint .mobile").text(c),$("#draw").on("click",function(){c=s.val();var a="";c||(a="请输入手机号领取红包");if(""!=a||/^1\d{10}$/.test(c)||(a="请输入正确手机号领取红包"),a)return void t.alert(a,"温馨提示!",function(){s.focus()});var d={mobile:c,code:code,_xsrf:n};$.post(o,d,function(o){if(!o||o.errcode)return 4002==o.errcode?void e():void t.alert(o.errmsg,"温馨提示!");var n=parseInt(o.coupon.discount/100);$("#number").text(n),$(".hint .mobile").text(c),r.hide(),i.show(),store.set("mobile",c)})});var a,d=60,u=!1,m=function(){u||($send_btn=$("#send_smscode"),$send_btn.text("("+d+"s)重新获取"),a=setInterval(function(){u=!0,d--,d>0?$send_btn.text("("+d+"s)重新获取"):(clearInterval(a),$send_btn.text("获取验证码"),d=60,u=!1)},1e3))};$(".up_mobile").on("click",function(){var e=t.prompt("您更换之前手机号:"+c,"手机号码更改",function(e){var o="";e||(o="请输入手机号");return""!=o||/^1\d{10}$/.test(e)||(o="请输入正确手机号"),o?void t.alert(o,"温馨提示!",function(){}):void $.post("/api/update_mobile",{mobile:e,_xsrf:n},function(o){return o&&o.errcode?void $("#reg_errmsg").text(o.errmsg):(t.alert("号码更换成功，下次领取红包时，将自动放入新手机账户"),void store.set("mobile",e))})});$(e).find(".modal-text-input").attr("type","tel").attr("maxlength",11).attr("placeholder","请输入您的新手机号")})});